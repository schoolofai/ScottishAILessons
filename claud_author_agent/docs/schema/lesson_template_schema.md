# Lesson Template Schema

Complete JSON schema for lesson templates generated by the Lesson Author agent.

## Overview

Lesson templates are detailed pedagogical designs containing 3-15 interactive learning cards. Each template aligns with Scottish Qualifications Authority (SQA) standards and Curriculum for Excellence (CfE) principles.

**File**: `lesson_template.json` (written to workspace by `lesson_author` subagent)
**Storage**: Compressed with gzip+base64 in `default.lesson_templates` collection
**Size**: Typically 3-8KB uncompressed, 1.5-4KB compressed (45-55% compression ratio)

---

## Top-Level Structure

```json
{
  "courseId": string,
  "title": string,
  "outcomeRefs": string[],
  "lesson_type": string,
  "estMinutes": number,
  "createdBy": string,
  "sow_order": number,
  "version": number,
  "status": string,
  "engagement_tags": string[],
  "policy": object,
  "cards": Card[]
}
```

---

## Field Specifications

### `courseId` (string, required)

**Description**: Course identifier from `default.courses` collection
**Format**: `"course_[alphanumeric]"`
**Example**: `"course_c84474"`
**Validation**: Must exist in database, must match SOW entry courseId

**Purpose**: Links lesson template to parent course for enrollment and progress tracking

---

### `title` (string, required)

**Description**: Lesson title reflecting learning focus
**Length**: 30-80 characters
**Format**: Sentence case, descriptive
**Example**: `"Calculating Fractions of Amounts"`

**Guidelines**:
- Clear and student-facing (not teacher jargon)
- Reflects the "what" and sometimes "how" of learning
- Avoids generic titles like "Lesson 1" or "Introduction"
- Scottish context where appropriate (e.g., "Budgeting for Edinburgh Festival Tickets")

---

### `outcomeRefs` (string[], required)

**Description**: Array of SQA outcome codes this lesson addresses
**Format**: Outcome codes from SOW entry or Course_data.txt
**Example**: `["O1", "AS1.2", "AS1.3"]`

**Types**:
- **Outcome codes** (e.g., `"O1"`, `"O2"`): Learning objectives
- **Assessment standard codes** (e.g., `"AS1.2"`): Specific assessment criteria

**Validation**:
- Must include at least one outcome from SOW entry outcomeRefs
- Codes must match enriched outcomes in Course_data.txt
- Cannot be empty array

**Purpose**: Ensures lesson aligns with SQA course requirements and enables outcome-based progress tracking

---

### `lesson_type` (string, required)

**Description**: Pedagogical category determining lesson structure
**Allowed Values**:
- `"teach"` - Introduction and modeling (I-We-You progression)
- `"independent_practice"` - Skill consolidation (minimal scaffolding)
- `"formative_assessment"` - Progress check (one card per assessment standard)
- `"revision"` - Memory retrieval (mixed practice)
- `"mock_exam"` - Exam preparation (8-15 cards, progressive difficulty)

**Example**: `"teach"`

**Impact**:
- Determines card count (teach: 3-4, mock_exam: 8-15)
- Influences scaffolding strategy (teach: high→low, independent: none)
- Affects CFU type selection (teach: varied, formative: structured_response)
- Guides hint provision (teach: extensive, independent: minimal)

---

### `estMinutes` (number, required)

**Description**: Estimated duration in minutes for lesson completion
**Range**: 30-90 minutes (typically 40-60)
**Example**: `50`

**Validation**:
- Must match SOW entry estMinutes (if provided)
- Should equal sum of individual card timings
- Realistic for secondary school class period (40-50 min) or double period (80-100 min)

**Purpose**: Enables timetable planning and session management

---

### `createdBy` (string, required)

**Description**: Agent identifier for audit trail
**Default**: `"lesson_author_agent"`
**Format**: Fixed string (hardcoded in agent)

**Purpose**: Distinguishes agent-authored templates from human-authored templates for quality monitoring

---

### `sow_order` (number, required)

**Description**: Sequential position in Scheme of Work
**Range**: 1-15 (1-indexed, matches SOW entry order)
**Example**: `1`

**Validation**:
- Must be >= 1 (0 is invalid)
- Must match SOW entry order from input
- Used for upsert query (courseId + sow_order uniqueness)

**Purpose**: Maintains lesson sequence and enables curriculum progression tracking

---

### `version` (number, required)

**Description**: Template version for change tracking
**Default**: `1`
**Format**: Integer starting at 1, incremented on updates

**Purpose**: Enables version history for template revisions (future feature)

---

### `status` (string, required)

**Description**: Publication state
**Allowed Values**:
- `"draft"` - Initial creation state (default)
- `"review"` - Awaiting human review (future state)
- `"published"` - Approved for student use (future state)

**Default**: `"draft"`

**Purpose**: Workflow management for human-in-the-loop review before student exposure

---

### `engagement_tags` (string[], required)

**Description**: Scottish contexts and real-world connections
**Format**: Array of lowercase hyphenated tags
**Example**: `["finance", "shopping", "transport"]`

**Common Tags**:
- **Finance**: `"finance"`, `"budgeting"`, `"savings"`
- **Shopping**: `"shopping"`, `"discounts"`, `"supermarkets"`
- **Transport**: `"transport"`, `"scotrail"`, `"buses"`
- **Healthcare**: `"healthcare"`, `"nhs"`, `"prescriptions"`
- **Events**: `"edinburgh-festival"`, `"hogmanay"`, `"sports-events"`

**Source**: Inherited from SOW entry engagement_tags
**Validation**: Can be empty array if no specific contexts apply

**Purpose**: Guides Scottish context selection in card explainers and CFU scenarios

---

### `policy` (object, required)

**Description**: Lesson-specific constraints and rules
**Structure**:
```json
{
  "calculator_allowed": boolean,
  "assessment_notes": string
}
```

**Fields**:
- **calculator_allowed** (boolean): Whether calculators permitted in this lesson
  - `true`: Students can use calculators (algebraic problems, complex calculations)
  - `false`: No calculators (mental math, fraction fundamentals, exam simulation)
- **assessment_notes** (string, optional): Additional guidance for teacher/agent

**Example**:
```json
{
  "calculator_allowed": false,
  "assessment_notes": "Non-calculator lesson building foundational numeracy"
}
```

**Purpose**: Ensures lesson aligns with SQA calculator policy and assessment standards

---

### `cards` (Card[], required)

**Description**: Array of learning cards (pedagogical units)
**Count**: 3-15 cards depending on lesson_type
**Order**: Sequential by pedagogical progression (Starter → Modelling → Practice → Assessment)

**Structure**: See [Card Schema](#card-schema) below

---

## Card Schema

Each card is a self-contained pedagogical unit with:
- Learning content (explainer)
- Formative assessment (CFU - Check For Understanding)
- Misconception anticipation
- Optional hints and context hooks

### Card Structure

```json
{
  "id": string,
  "title": string,
  "explainer": string,
  "explainer_plain": string,
  "cfu": CFU_Object,
  "misconceptions": Misconception[],
  "context_hooks": string[]
}
```

---

### Card Field: `id` (string, required)

**Description**: Unique card identifier within lesson
**Format**: `"card_[3-digit-number]"`
**Example**: `"card_001"`, `"card_002"`

**Guidelines**:
- Zero-padded 3-digit sequential numbering
- Unique within lesson (not globally unique)
- Predictable ordering (card_001, card_002, ...)

---

### Card Field: `title` (string, required)

**Description**: Card heading describing learning focus
**Length**: 20-60 characters
**Format**: Often includes stage (Starter, Modelling, Practice, Assessment)

**Examples**:
- `"Starter: Fraction Recall"`
- `"Modelling: Finding Fractions"`
- `"Guided Practice: Shopping Scenario"`
- `"Independent Practice: Train Tickets"`

**Guidelines**:
- Student-facing language
- Describes the activity or concept
- May include Scottish context reference

---

### Card Field: `explainer` (string, required)

**Description**: Detailed learning content with step-by-step guidance
**Length**: 100-500 words
**Format**: Markdown-supported (bold, bullets, numbered lists)

**Components** (for teach lessons):
1. **Hook/Connection**: Links to prior knowledge or real-world context
2. **Concept Introduction**: Defines key terms and ideas
3. **Worked Example**: Step-by-step demonstration with Scottish context
4. **Why It Works**: Conceptual explanation (not just procedure)
5. **Transition**: "Now you try..." prompt to CFU

**Scottish Context Requirements**:
- Currency: Always £ (never $, €)
- Locations: Scottish cities, landmarks (Edinburgh, Glasgow, Highlands)
- Brands: Scottish companies (Tesco Scotland, ScotRail, NHS Scotland)
- Events: Scottish cultural references (Hogmanay, Edinburgh Festival)

**Example** (see mock_lesson_template.json lines 50-51 for full example)

---

### Card Field: `explainer_plain` (string, required)

**Description**: Accessibility-optimized version of explainer
**Purpose**: Supports dyslexic students and CEFR A2-B1 English learners
**Length**: 60-80% of original explainer length

**CEFR A2-B1 Transformations**:
1. **Sentence Length**: 8-12 words per sentence (vs. 15-20 in original)
2. **Active Voice**: "Divide £20 by 4" (not "£20 is divided by 4")
3. **Simple Connectives**: "First", "Then", "Next" (avoid "However", "Moreover")
4. **Concrete Nouns**: "pizza" not "circular food item"
5. **Present Tense**: "We divide" (avoid perfect/continuous tenses)
6. **Short Bullet Points**: One idea per line

**Example** (see mock_lesson_template.json line 51 for full example)

**Validation**: Critic checks for sentence length, active voice, concrete language

---

### Card Field: `cfu` (object, required)

**Description**: Check For Understanding - formative assessment question
**Purpose**: Immediate practice and understanding verification

**Type-Specific Schemas**: See [CFU Type Schemas](#cfu-type-schemas) below

**Common Fields** (all types):
- `type`: CFU type identifier
- `id`: Unique question ID within lesson
- `stem`: Question text (student-facing)
- `rubric`: Marking scheme with SQA alignment

---

## CFU Type Schemas

### CFU Type: `mcq` (Multiple Choice Question)

**Use Case**: Quick concept checks, fact recall, misconception diagnosis

```json
{
  "type": "mcq",
  "id": "q001",
  "stem": "Which of these represents one-quarter?",
  "options": ["1/4", "1/2", "1/3", "2/4"],
  "answerIndex": 0,
  "rubric": {
    "total_points": 1,
    "criteria": [
      {
        "description": "Correctly identifies fraction notation",
        "points": 1
      }
    ]
  }
}
```

**Fields**:
- **options** (string[]): 3-5 answer choices
- **answerIndex** (number): Zero-indexed correct answer position
- **Distractors**: Include common misconceptions in incorrect options

---

### CFU Type: `numeric` (Numeric Answer)

**Use Case**: Calculation problems with single numeric answer

```json
{
  "type": "numeric",
  "id": "q003",
  "stem": "A box costs £12. It's reduced by 1/3. How much is the discount?",
  "expected": 4.0,
  "tolerance": 0.01,
  "money2dp": true,
  "rubric": {
    "total_points": 2,
    "criteria": [
      {
        "description": "Correctly calculates 1/3 of £12",
        "points": 1
      },
      {
        "description": "States correct discount: £4",
        "points": 1
      }
    ]
  },
  "hints": [
    "Divide £12 by 3 to find 1/3",
    "What is £12 ÷ 3?",
    "Check: 1/3 is about 33%, so discount should be around £4"
  ]
}
```

**Fields**:
- **expected** (number): Correct numeric answer
- **tolerance** (number): Acceptable margin (e.g., 0.01 for money)
- **money2dp** (boolean): Enforce 2 decimal places for currency
- **hints** (string[], optional): Progressive hint sequence (3-5 hints)

**Hint Guidelines**:
- Hint 1: Restate problem in simpler terms
- Hint 2: Suggest first step
- Hint 3: Provide calculation guidance
- Hint 4 (optional): Give partial answer or verification strategy

---

### CFU Type: `structured_response` (Extended Written Answer)

**Use Case**: Multi-step problems, show-your-working questions, explanations

```json
{
  "type": "structured_response",
  "id": "q004",
  "stem": "A train ticket costs £24. Sarah gets 1/3 off. Calculate:\n(a) The discount amount\n(b) The price Sarah pays",
  "rubric": {
    "total_points": 4,
    "criteria": [
      {
        "description": "Correctly calculates discount: 1/3 of £24 = £8",
        "points": 2
      },
      {
        "description": "Correctly calculates final price: £24 - £8 = £16",
        "points": 2
      }
    ]
  }
}
```

**Fields**:
- **stem** (string): Multi-part question with (a), (b), (c) structure
- **rubric** (object): Detailed marking scheme with method + accuracy marks

**Rubric Guidelines**:
- **Method marks**: Award for correct process even if final answer wrong
- **Accuracy marks**: Award for correct final answer
- **SQA alignment**: Follow official SQA mark allocation patterns (typically 60% method, 40% accuracy)

---

### CFU Type: `short_text` (Brief Written Response)

**Use Case**: Definitions, brief explanations, single-sentence answers

```json
{
  "type": "short_text",
  "id": "q005",
  "stem": "Explain what the denominator in a fraction represents.",
  "rubric": {
    "total_points": 2,
    "criteria": [
      {
        "description": "Mentions 'total number of equal parts'",
        "points": 1
      },
      {
        "description": "Provides example (e.g., 'In 1/4, denominator 4 means 4 equal parts')",
        "points": 1
      }
    ]
  }
}
```

---

### Card Field: `misconceptions` (Misconception[], required)

**Description**: Anticipated student errors with clarifications
**Count**: 1-3 misconceptions per card
**Purpose**: Proactive error prevention and remediation

**Structure**:
```json
{
  "id": "MISC_MATH_FRAC_001",
  "misconception": "Confusing numerator and denominator",
  "clarification": "Remember: bottom number shows how many equal parts, top number shows how many you have"
}
```

**Fields**:
- **id** (string): Standardized misconception code
  - Format: `"MISC_[SUBJECT]_[TOPIC]_[NUMBER]"`
  - Example: `"MISC_MATH_FRAC_003"` (Math, Fractions, #3)
- **misconception** (string): Brief description of error pattern
- **clarification** (string): Corrective explanation (20-50 words)

**Misconception ID Prefixes**:
- `MISC_MATH_`: Mathematics misconceptions
- `MISC_SCI_`: Science misconceptions
- `MISC_ENG_`: English misconceptions

**Guidelines**:
- Focus on conceptual errors, not careless mistakes
- Provide "why" explanation, not just "how to fix"
- Use student-friendly language
- Include examples where helpful

---

### Card Field: `context_hooks` (string[], optional)

**Description**: Implementation notes for Scottish contexts
**Purpose**: Documents authentic context choices for future reference
**Example**: `["ScotRail Edinburgh-Glasgow route", "Railcard 1/3 discount is real policy"]`

**Format**: Array of brief strings (10-30 words each)

**Use Cases**:
- Scottish authenticity justification
- Real-world data sources (e.g., "Tesco meal deal £3.50 as of 2024")
- Cultural context explanations (e.g., "Hogmanay is Scottish New Year celebration")

**Validation**: Optional field, can be empty array

---

## Rubric Structure (All CFU Types)

```json
{
  "total_points": number,
  "criteria": [
    {
      "description": string,
      "points": number
    }
  ]
}
```

**Fields**:
- **total_points** (number): Sum of all criteria points
- **criteria** (array): Breakdown of mark allocation

**SQA Alignment Principles**:
1. **Method + Accuracy**: Award method marks for correct process
2. **Partial Credit**: Fine-grained criteria (e.g., 2 marks for calculation, 1 for units)
3. **Clear Descriptors**: Each criterion specifies observable behavior
4. **Point Range**: 1-5 points per lesson card (teach: 1-3, formative: 3-5, mock_exam: 4-8)

---

## Validation Rules

### Critic-Enforced Constraints

The `combined_lesson_critic` validates templates against:

1. **Pedagogical Design (0.20)**:
   - Card count matches lesson_type
   - I-We-You progression (teach lessons)
   - Scaffolding appropriate for lesson stage

2. **Assessment Design (0.25)**:
   - CFU types match lesson_type
   - Rubrics follow SQA structure
   - Hints present where needed

3. **Accessibility (0.20)**:
   - explainer_plain meets CEFR A2-B1 standards
   - Sentence length <= 12 words
   - Active voice, concrete nouns

4. **Scottish Context (0.20)**:
   - Currency is £ (never $, €)
   - Locations/brands are Scottish
   - Pricing realistic for Scotland

5. **Coherence (0.15)**:
   - Title reflects lesson focus
   - Timing sum equals estMinutes
   - No contradictions between cards

6. **SOW Fidelity (0.25)**:
   - Aligns with outcomeRefs
   - Respects engagement_tags
   - Follows policy constraints

**Pass Threshold**: All dimensions >= 0.85-0.88, weighted average >= 0.88

---

## Size and Performance

**Typical Sizes**:
- **Uncompressed JSON**: 3-8 KB (teach: 4-5 KB, mock_exam: 8-12 KB)
- **Compressed (gzip+base64)**: 1.5-4 KB (45-55% compression ratio)
- **Storage format**: Base64 string in `default.lesson_templates.cards` field

**Performance**:
- **Compression time**: <50ms
- **Decompression time**: <30ms
- **Database write**: 200-500ms (Appwrite MCP)

---

## Complete Example

See `tests/mock_lesson_template.json` for a fully-compliant example template with:
- 4 cards (teach lesson on "Calculating Fractions of Amounts")
- Scottish contexts (ScotRail, Tesco, Edinburgh)
- I-We-You progression (Starter → Modelling → Guided → Independent)
- CEFR-compliant accessibility (explainer_plain for all cards)
- SQA-aligned rubrics (method + accuracy marks)
- Misconception anticipation (4 misconceptions across cards)

---

## Related Documentation

- [Lesson Critic Result Schema](./lesson_critic_result_schema.md) - Validation output format
- [SOW Entry Input Schema](./sow_entry_input_schema.md) - Input format for lesson authoring
- [Lesson Author README](../LESSON_AUTHOR_README.md) - User guide and CLI usage
- [Implementation Status](../LESSON_AUTHOR_IMPLEMENTATION_STATUS.md) - Development tracking

---

**Version**: 1.0
**Last Updated**: October 2025
**Maintained By**: Lesson Author Agent Documentation


---

## Field Usage in Teaching Runtime

### Runtime Usage Guidance

- `lesson_type`: Used to tailor pedagogy (teach/independent_practice/formative_assessment/revision) in the teacher prompts.
- `engagement_tags`: Mapped to concrete teaching strategies in prompts (e.g., scaffolding, visual aids).
- `policy`: Adds reminders (e.g., calculator allowed) to constrain instruction.
- `outcomeRefs`: Enriched and summarized to show SQA alignment in prompts.
- `estMinutes`: Captured in runtime state for analytics (future: pacing/timeouts).
- `cards[].explainer_plain`: Used when accessibility mode is enabled.
- `cards[].misconceptions`: Exposed to LLM evaluation to target known error patterns.
- `cards[].cfu.rubric`: Passed into structured evaluation for rubric-aligned partial credit.
- `cards[].cfu.hints`: Presented before LLM fallback during retries.
- `cards[].cfu.tolerance`: Used to pre-validate numeric answers within margin.

### Actively Used Fields

| Field Path | Runtime Usage | Implementation |
|------------|---------------|----------------|
| `title` | Lesson context in prompts | `langgraph-agent/src/agent/llm_teacher.py` |
| `courseId` | Mastery tracking updates | `langgraph-agent/src/agent/teacher_graph_toolcall_interrupt.py` |
| `lesson_type` | Differentiated pedagogy | `llm_teacher.py:get_lesson_type_pedagogy_guidance` |
| `engagement_tags` | Teaching strategies block | `llm_teacher.py:format_course_context_for_prompt` |
| `policy` | Calculator/formula reminders | `llm_teacher.py:format_course_context_for_prompt` |
| `estMinutes` | Duration logging (analytics) | `graph_interrupt.py`, `teacher_graph_toolcall_interrupt.py` |
| `outcomeRefs` | SQA alignment summary | `llm_teacher.py:parse_outcome_refs` |
| `cards[].explainer` | Main teaching content | `llm_teacher.py` |
| `cards[].explainer_plain` | Accessibility mode content | `llm_teacher.py` |
| `cards[].misconceptions` | Feedback targeting error patterns | `llm_teacher.py` |
| `cards[].cfu.rubric` | Rubric-based structured evaluation | `llm_teacher.py` |
| `cards[].cfu.hints` | Progressive scaffolding in retry flow | `teacher_graph_toolcall_interrupt.py` |
| `cards[].cfu.tolerance` | Numeric pre-validation | `teacher_graph_toolcall_interrupt.py` |

### Metadata-Only / Authoring Fields

| Field | Purpose | Runtime |
|-------|---------|---------|
| `createdBy` | Authoring attribution | Not used at runtime |
| `version` | Template versioning | Not used at runtime |
| `status` | Publication workflow | Not used at runtime (filtered upstream) |
| `context_hooks` | Author notes, context provenance | Not used at runtime |
