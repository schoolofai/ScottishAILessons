# Comprehensive Structured Output Refactor Plan

**Status**: üìã PLANNED
**Created**: 2026-01-19
**Scope**: All iterative SOW author phases

---

## ‚ö†Ô∏è CRITICAL: Outline Simplification

The outline generator must **ONLY** produce these lesson types:

| Allowed | ‚ùå NOT Allowed |
|---------|----------------|
| `teach` | `revision` |
| `mock_exam` | `formative_assessment` |
| | `independent_practice` |

**Rationale**: Revision, formative assessment, and independent practice are **pedagogical patterns** that belong *inside* lesson content (as card types or learning activities), not as separate lesson types in the outline.

A simplified outline:
- Focuses on core **teaching moments** (`teach`)
- Ends with **summative assessment** (`mock_exam`)
- Is easier to generate accurately
- Avoids LLM confusion about teach-revision pairing rules

---

## Problem Statement

The current `iterative_sow_author.py` uses Claude Agent SDK but with a **file-based output pattern**:

```
‚ùå CURRENT (WRONG) APPROACH:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Agent ‚Üí Write tool ‚Üí /workspace/lesson_outline.json ‚Üí Python reads file   ‚îÇ
‚îÇ                                                                             ‚îÇ
‚îÇ  Problems:                                                                  ‚îÇ
‚îÇ  - No schema enforcement during generation                                  ‚îÇ
‚îÇ  - Agent can write malformed JSON                                          ‚îÇ
‚îÇ  - Extra file I/O overhead                                                 ‚îÇ
‚îÇ  - Validation happens AFTER generation (too late)                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

The Claude Agent SDK provides **native structured output support** that should be used instead:

```
‚úÖ CORRECT APPROACH:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  query(                                                                     ‚îÇ
‚îÇ      prompt="Generate outline...",                                         ‚îÇ
‚îÇ      options={                                                             ‚îÇ
‚îÇ          "output_format": {                                                ‚îÇ
‚îÇ              "type": "json_schema",                                        ‚îÇ
‚îÇ              "schema": LessonOutline.model_json_schema()                   ‚îÇ
‚îÇ          }                                                                 ‚îÇ
‚îÇ      }                                                                     ‚îÇ
‚îÇ  ) ‚Üí message.structured_output ‚Üí LessonOutline.model_validate()           ‚îÇ
‚îÇ                                                                             ‚îÇ
‚îÇ  Benefits:                                                                  ‚îÇ
‚îÇ  - Schema enforced DURING generation                                       ‚îÇ
‚îÇ  - Guaranteed valid output                                                 ‚îÇ
‚îÇ  - No file parsing needed                                                  ‚îÇ
‚îÇ  - Type-safe Pydantic objects                                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## Refactored Architecture Overview

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                 ITERATIVE SOW AUTHOR - STRUCTURED OUTPUT ARCHITECTURE            ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë                                                                                  ‚ïë
‚ïë  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚ïë
‚ïë  ‚îÇ                         PHASE 0: DATA EXTRACTION                            ‚îÇ‚ïë
‚ïë  ‚îÇ                         (Python only - no LLM)                              ‚îÇ‚ïë
‚ïë  ‚îÇ                                                                             ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       Python        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ Appwrite        ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂  ‚îÇ Course_outcomes.json        ‚îÇ  ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ course_outcomes ‚îÇ   (MCP query)       ‚îÇ (workspace file for context)‚îÇ  ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ‚ïë
‚ïë  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚ïë
‚ïë                                       ‚îÇ                                          ‚ïë
‚ïë                                       ‚ñº                                          ‚ïë
‚ïë  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚ïë
‚ïë  ‚îÇ                      PHASE 1: OUTLINE GENERATION                            ‚îÇ‚ïë
‚ïë  ‚îÇ                                                                             ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  STEP 1A: OUTLINE AUTHOR                                              ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ                                                                       ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ INPUTS              ‚îÇ                    ‚îÇ OUTPUT              ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ                     ‚îÇ     Claude SDK     ‚îÇ                     ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ ‚Ä¢ Course_outcomes   ‚îÇ     query() with   ‚îÇ LessonOutline       ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ   .json (Read)      ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ (Pydantic)          ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ ‚Ä¢ outline_author    ‚îÇ     output_format  ‚îÇ                     ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ   _prompt.md        ‚îÇ                    ‚îÇ ‚Ä¢ course_subject    ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ                     ‚îÇ                    ‚îÇ ‚Ä¢ course_level      ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ                     ‚îÇ                    ‚îÇ ‚Ä¢ total_lessons     ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ                     ‚îÇ                    ‚îÇ ‚Ä¢ structure_type    ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ                     ‚îÇ                    ‚îÇ ‚Ä¢ outlines[]        ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ‚ïë
‚ïë  ‚îÇ                                       ‚îÇ                                     ‚îÇ‚ïë
‚ïë  ‚îÇ                                       ‚ñº                                     ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  STEP 1B: OUTLINE CRITIC                                              ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ                                                                       ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ INPUTS              ‚îÇ                    ‚îÇ OUTPUT              ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ                     ‚îÇ     Claude SDK     ‚îÇ                     ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ ‚Ä¢ Course_outcomes   ‚îÇ     query() with   ‚îÇ OutlineCriticResult ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ   .json (Read)      ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ (Pydantic)          ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ ‚Ä¢ LessonOutline     ‚îÇ     output_format  ‚îÇ                     ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ   (from 1A)         ‚îÇ                    ‚îÇ ‚Ä¢ verdict           ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ ‚Ä¢ outline_critic    ‚îÇ                    ‚îÇ ‚Ä¢ overall_score     ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ   _prompt.md        ‚îÇ                    ‚îÇ ‚Ä¢ dimensions{}      ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ                     ‚îÇ                    ‚îÇ ‚Ä¢ revision_guidance ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ                     ‚îÇ                    ‚îÇ ‚Ä¢ summary           ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ‚ïë
‚ïë  ‚îÇ                                       ‚îÇ                                     ‚îÇ‚ïë
‚ïë  ‚îÇ                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                 ‚îÇ‚ïë
‚ïë  ‚îÇ                    ‚îÇ verdict == "PASS"?                   ‚îÇ                 ‚îÇ‚ïë
‚ïë  ‚îÇ                    ‚îÇ Yes ‚Üí Phase 2                        ‚îÇ                 ‚îÇ‚ïë
‚ïë  ‚îÇ                    ‚îÇ No ‚Üí Loop to 1A (max 3 iterations)   ‚îÇ                 ‚îÇ‚ïë
‚ïë  ‚îÇ                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                 ‚îÇ‚ïë
‚ïë  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚ïë
‚ïë                                       ‚îÇ                                          ‚ïë
‚ïë                                       ‚ñº                                          ‚ïë
‚ïë  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚ïë
‚ïë  ‚îÇ                      PHASE 2: LESSON GENERATION                             ‚îÇ‚ïë
‚ïë  ‚îÇ                      (Loop for each lesson in outline)                      ‚îÇ‚ïë
‚ïë  ‚îÇ                                                                             ‚îÇ‚ïë
‚ïë  ‚îÇ  FOR lesson_idx = 1 to N:                                                  ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  STEP 2A: LESSON AUTHOR                                               ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ                                                                       ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ INPUTS              ‚îÇ                    ‚îÇ OUTPUT              ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ                     ‚îÇ     Claude SDK     ‚îÇ                     ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ ‚Ä¢ Course_outcomes   ‚îÇ     query() with   ‚îÇ SOWEntry            ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ   .json (Read)      ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ (Pydantic)          ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ ‚Ä¢ LessonOutline     ‚îÇ     output_format  ‚îÇ                     ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ   Entry[idx]        ‚îÇ                    ‚îÇ ‚Ä¢ order             ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ ‚Ä¢ Previous lessons  ‚îÇ                    ‚îÇ ‚Ä¢ label             ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ   (for coherence)   ‚îÇ                    ‚îÇ ‚Ä¢ lesson_type       ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ ‚Ä¢ lesson_entry      ‚îÇ                    ‚îÇ ‚Ä¢ lesson_plan{}     ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ   _prompt.md        ‚îÇ                    ‚îÇ ‚Ä¢ accessibility{}   ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ                     ‚îÇ                    ‚îÇ ‚Ä¢ engagement_tags[] ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ                     ‚îÇ                    ‚îÇ ‚Ä¢ ...               ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ‚ïë
‚ïë  ‚îÇ                                       ‚îÇ                                     ‚îÇ‚ïë
‚ïë  ‚îÇ                                       ‚ñº                                     ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  STEP 2B: LESSON CRITIC                                               ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ                                                                       ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ INPUTS              ‚îÇ                    ‚îÇ OUTPUT              ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ                     ‚îÇ     Claude SDK     ‚îÇ                     ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ ‚Ä¢ Course_outcomes   ‚îÇ     query() with   ‚îÇ LessonCriticResult  ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ   .json (Read)      ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ (Pydantic)          ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ ‚Ä¢ LessonOutline     ‚îÇ     output_format  ‚îÇ                     ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ   Entry[idx]        ‚îÇ                    ‚îÇ ‚Ä¢ verdict           ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ ‚Ä¢ SOWEntry          ‚îÇ                    ‚îÇ ‚Ä¢ overall_score     ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ   (from 2A)         ‚îÇ                    ‚îÇ ‚Ä¢ lesson_order      ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ ‚Ä¢ lesson_critic     ‚îÇ                    ‚îÇ ‚Ä¢ dimensions{}      ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ   _prompt.md        ‚îÇ                    ‚îÇ ‚Ä¢ revision_guidance ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ                     ‚îÇ                    ‚îÇ ‚Ä¢ summary           ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ‚ïë
‚ïë  ‚îÇ                                       ‚îÇ                                     ‚îÇ‚ïë
‚ïë  ‚îÇ                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                 ‚îÇ‚ïë
‚ïë  ‚îÇ                    ‚îÇ verdict == "PASS"?                   ‚îÇ                 ‚îÇ‚ïë
‚ïë  ‚îÇ                    ‚îÇ Yes ‚Üí Next lesson (or Phase 3)       ‚îÇ                 ‚îÇ‚ïë
‚ïë  ‚îÇ                    ‚îÇ No ‚Üí Loop to 2A (max 2 iterations)   ‚îÇ                 ‚îÇ‚ïë
‚ïë  ‚îÇ                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                 ‚îÇ‚ïë
‚ïë  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚ïë
‚ïë                                       ‚îÇ                                          ‚ïë
‚ïë                                       ‚ñº                                          ‚ïë
‚ïë  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚ïë
‚ïë  ‚îÇ                      PHASE 3: METADATA GENERATION                           ‚îÇ‚ïë
‚ïë  ‚îÇ                                                                             ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  METADATA AUTHOR                                                      ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ                                                                       ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ INPUTS              ‚îÇ                    ‚îÇ OUTPUT              ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ                     ‚îÇ     Claude SDK     ‚îÇ                     ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ ‚Ä¢ All SOWEntry[]    ‚îÇ     query() with   ‚îÇ Metadata            ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ   (from Phase 2)    ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ (Pydantic)          ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ ‚Ä¢ LessonOutline     ‚îÇ     output_format  ‚îÇ                     ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ ‚Ä¢ metadata_author   ‚îÇ                    ‚îÇ ‚Ä¢ coherence{}       ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ   _prompt.md        ‚îÇ                    ‚îÇ ‚Ä¢ accessibility[]   ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ                     ‚îÇ                    ‚îÇ ‚Ä¢ engagement[]      ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ                     ‚îÇ                    ‚îÇ ‚Ä¢ weeks             ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ                     ‚îÇ                    ‚îÇ ‚Ä¢ periods_per_week  ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ‚ïë
‚ïë  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚ïë
‚ïë                                       ‚îÇ                                          ‚ïë
‚ïë                                       ‚ñº                                          ‚ïë
‚ïë  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚ïë
‚ïë  ‚îÇ                      PHASE 4: ASSEMBLY & UPSERT                             ‚îÇ‚ïë
‚ïë  ‚îÇ                      (Python only - no LLM)                                 ‚îÇ‚ïë
‚ïë  ‚îÇ                                                                             ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ASSEMBLER                                                            ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ                                                                       ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ INPUTS              ‚îÇ                    ‚îÇ OUTPUT              ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ                     ‚îÇ      Python        ‚îÇ                     ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ ‚Ä¢ LessonOutline     ‚îÇ      (no LLM)      ‚îÇ AuthoredSOW         ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ ‚Ä¢ SOWEntry[]        ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ (Pydantic)          ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ ‚Ä¢ Metadata          ‚îÇ                    ‚îÇ                     ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ                     ‚îÇ                    ‚îÇ ‚Ä¢ courseId          ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ                     ‚îÇ                    ‚îÇ ‚Ä¢ version           ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ                     ‚îÇ                    ‚îÇ ‚Ä¢ metadata{}        ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ                     ‚îÇ                    ‚îÇ ‚Ä¢ entries[]         ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ‚ïë
‚ïë  ‚îÇ                                       ‚îÇ                                     ‚îÇ‚ïë
‚ïë  ‚îÇ                                       ‚ñº                                     ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  UPSERTER                                                             ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ                                                                       ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ INPUT               ‚îÇ                    ‚îÇ OUTPUT              ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ                     ‚îÇ      Python        ‚îÇ                     ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ ‚Ä¢ AuthoredSOW       ‚îÇ      (MCP upsert)  ‚îÇ document_id         ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îÇ                     ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ (Appwrite)          ‚îÇ  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ ‚îÇ‚ïë
‚ïë  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ‚ïë
‚ïë  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚ïë
‚ïë                                                                                  ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
```

---

## Pydantic Schema Summary

### Phase 1 Schemas

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  PHASE 1 SCHEMAS                                                                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ  LessonOutline (output of Outline Author)                                   ‚îÇ‚îÇ
‚îÇ  ‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ                                    ‚îÇ‚îÇ
‚îÇ  ‚îÇ  {                                                                          ‚îÇ‚îÇ
‚îÇ  ‚îÇ    "course_subject": str,           # "applications-of-mathematics"         ‚îÇ‚îÇ
‚îÇ  ‚îÇ    "course_level": str,             # "higher"                              ‚îÇ‚îÇ
‚îÇ  ‚îÇ    "total_lessons": int,            # 12                                    ‚îÇ‚îÇ
‚îÇ  ‚îÇ    "structure_type": Literal["unit_based", "skills_based"],                ‚îÇ‚îÇ
‚îÇ  ‚îÇ    "outlines": [                                                           ‚îÇ‚îÇ
‚îÇ  ‚îÇ      {                                                                      ‚îÇ‚îÇ
‚îÇ  ‚îÇ        "order": int,                # 1, 2, 3...                            ‚îÇ‚îÇ
‚îÇ  ‚îÇ        "lesson_type": Literal["teach", "mock_exam"],  # SIMPLIFIED         ‚îÇ‚îÇ
‚îÇ  ‚îÇ        "label_hint": str,           # "Introduction to Surds"               ‚îÇ‚îÇ
‚îÇ  ‚îÇ        "block_name": str,           # "Numerical Skills"                    ‚îÇ‚îÇ
‚îÇ  ‚îÇ        "block_index": str,          # "B1"                                  ‚îÇ‚îÇ
‚îÇ  ‚îÇ        "primary_outcome_or_skill": str,                                    ‚îÇ‚îÇ
‚îÇ  ‚îÇ        "standards_or_skills_codes": List[str],                             ‚îÇ‚îÇ
‚îÇ  ‚îÇ        "rationale": str             # 20-300 chars                          ‚îÇ‚îÇ
‚îÇ  ‚îÇ      }                                                                      ‚îÇ‚îÇ
‚îÇ  ‚îÇ    ]                                                                        ‚îÇ‚îÇ
‚îÇ  ‚îÇ  }                                                                          ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ  OutlineCriticResult (output of Outline Critic)                             ‚îÇ‚îÇ
‚îÇ  ‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ                             ‚îÇ‚îÇ
‚îÇ  ‚îÇ  {                                                                          ‚îÇ‚îÇ
‚îÇ  ‚îÇ    "verdict": Literal["PASS", "REVISION_REQUIRED"],                        ‚îÇ‚îÇ
‚îÇ  ‚îÇ    "overall_score": float,          # 0.0 - 1.0                             ‚îÇ‚îÇ
‚îÇ  ‚îÇ    "dimensions": {                                                          ‚îÇ‚îÇ
‚îÇ  ‚îÇ      "coverage": DimensionScore,    # All standards mapped?                 ‚îÇ‚îÇ
‚îÇ  ‚îÇ      "sequencing": DimensionScore,  # Prerequisites respected?              ‚îÇ‚îÇ
‚îÇ  ‚îÇ      "balance": DimensionScore,     # Block distribution?                   ‚îÇ‚îÇ
‚îÇ  ‚îÇ      "progression": DimensionScore, # Complexity growth?                    ‚îÇ‚îÇ
‚îÇ  ‚îÇ      "chunking": DimensionScore     # Standards per lesson?                 ‚îÇ‚îÇ
‚îÇ  ‚îÇ    },                                                                       ‚îÇ‚îÇ
‚îÇ  ‚îÇ    "revision_guidance": List[str],  # Prioritized changes                   ‚îÇ‚îÇ
‚îÇ  ‚îÇ    "summary": str                   # Brief explanation                     ‚îÇ‚îÇ
‚îÇ  ‚îÇ  }                                                                          ‚îÇ‚îÇ
‚îÇ  ‚îÇ                                                                             ‚îÇ‚îÇ
‚îÇ  ‚îÇ  DimensionScore = { "score": float, "issues": List[str], "notes": str }    ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Phase 2 Schemas

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  PHASE 2 SCHEMAS                                                                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ  SOWEntry (output of Lesson Author)                                         ‚îÇ‚îÇ
‚îÇ  ‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ                                         ‚îÇ‚îÇ
‚îÇ  ‚îÇ  {                                                                          ‚îÇ‚îÇ
‚îÇ  ‚îÇ    "order": int,                    # 1, 2, 3...                             ‚îÇ‚îÇ
‚îÇ  ‚îÇ    "label": str,                    # "Introduction to Surds"               ‚îÇ‚îÇ
‚îÇ  ‚îÇ    "lesson_type": LessonType,       # teach, revision, etc.                 ‚îÇ‚îÇ
‚îÇ  ‚îÇ    "estMinutes": int,               # 50                                    ‚îÇ‚îÇ
‚îÇ  ‚îÇ    "lesson_plan": {                                                         ‚îÇ‚îÇ
‚îÇ  ‚îÇ      "cards": [                                                             ‚îÇ‚îÇ
‚îÇ  ‚îÇ        {                                                                    ‚îÇ‚îÇ
‚îÇ  ‚îÇ          "type": CardType,          # starter, explainer, etc.              ‚îÇ‚îÇ
‚îÇ  ‚îÇ          "learning_objectives": List[...],                                 ‚îÇ‚îÇ
‚îÇ  ‚îÇ          "content": {...},                                                 ‚îÇ‚îÇ
‚îÇ  ‚îÇ          "cfu": {...}                                                      ‚îÇ‚îÇ
‚îÇ  ‚îÇ        }                                                                    ‚îÇ‚îÇ
‚îÇ  ‚îÇ      ]                                                                      ‚îÇ‚îÇ
‚îÇ  ‚îÇ    },                                                                       ‚îÇ‚îÇ
‚îÇ  ‚îÇ    "standards_or_skills": List[StandardOrSkillRef],                        ‚îÇ‚îÇ
‚îÇ  ‚îÇ    "accessibility": AccessibilityProfile,                                  ‚îÇ‚îÇ
‚îÇ  ‚îÇ    "engagement_tags": List[str],                                           ‚îÇ‚îÇ
‚îÇ  ‚îÇ    "block_name": str,                                                      ‚îÇ‚îÇ
‚îÇ  ‚îÇ    "block_index": str                                                      ‚îÇ‚îÇ
‚îÇ  ‚îÇ  }                                                                          ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ  LessonCriticResult (output of Lesson Critic)                               ‚îÇ‚îÇ
‚îÇ  ‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ                               ‚îÇ‚îÇ
‚îÇ  ‚îÇ  {                                                                          ‚îÇ‚îÇ
‚îÇ  ‚îÇ    "verdict": Literal["PASS", "REVISION_REQUIRED"],                        ‚îÇ‚îÇ
‚îÇ  ‚îÇ    "overall_score": float,          # 0.0 - 1.0                             ‚îÇ‚îÇ
‚îÇ  ‚îÇ    "lesson_order": int,             # Which lesson was critiqued            ‚îÇ‚îÇ
‚îÇ  ‚îÇ    "dimensions": {                                                          ‚îÇ‚îÇ
‚îÇ  ‚îÇ      "coverage": DimensionScore,    # Standards addressed in cards?         ‚îÇ‚îÇ
‚îÇ  ‚îÇ      "sequencing": DimensionScore,  # Card flow pedagogically sound?        ‚îÇ‚îÇ
‚îÇ  ‚îÇ      "policy": DimensionScore,      # Engagement tags honored?              ‚îÇ‚îÇ
‚îÇ  ‚îÇ      "accessibility": DimensionScore, # Adaptations provided?               ‚îÇ‚îÇ
‚îÇ  ‚îÇ      "authenticity": DimensionScore   # Scottish context?                   ‚îÇ‚îÇ
‚îÇ  ‚îÇ    },                                                                       ‚îÇ‚îÇ
‚îÇ  ‚îÇ    "revision_guidance": List[str],  # Prioritized changes for this lesson   ‚îÇ‚îÇ
‚îÇ  ‚îÇ    "summary": str                   # Brief explanation                     ‚îÇ‚îÇ
‚îÇ  ‚îÇ  }                                                                          ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Phase 3 & 4 Schemas

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  PHASE 3 & 4 SCHEMAS                                                             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ  Metadata (output of Metadata Author)                                       ‚îÇ‚îÇ
‚îÇ  ‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ                                       ‚îÇ‚îÇ
‚îÇ  ‚îÇ  {                                                                          ‚îÇ‚îÇ
‚îÇ  ‚îÇ    "coherence": {                                                           ‚îÇ‚îÇ
‚îÇ  ‚îÇ      "narrative_summary": str,      # Course journey overview               ‚îÇ‚îÇ
‚îÇ  ‚îÇ      "cross_lesson_links": List[str],                                      ‚îÇ‚îÇ
‚îÇ  ‚îÇ      "sequencing_notes": List[str]                                         ‚îÇ‚îÇ
‚îÇ  ‚îÇ    },                                                                       ‚îÇ‚îÇ
‚îÇ  ‚îÇ    "accessibility_notes": List[str], # Course-level accessibility           ‚îÇ‚îÇ
‚îÇ  ‚îÇ    "engagement_notes": List[str],    # Course-level engagement              ‚îÇ‚îÇ
‚îÇ  ‚îÇ    "weeks": Optional[int],           # Estimated duration                   ‚îÇ‚îÇ
‚îÇ  ‚îÇ    "periods_per_week": Optional[int]                                       ‚îÇ‚îÇ
‚îÇ  ‚îÇ  }                                                                          ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ  AuthoredSOW (output of Assembler - FINAL OUTPUT)                           ‚îÇ‚îÇ
‚îÇ  ‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ                           ‚îÇ‚îÇ
‚îÇ  ‚îÇ  {                                                                          ‚îÇ‚îÇ
‚îÇ  ‚îÇ    "courseId": str,                 # "course_c84476"                       ‚îÇ‚îÇ
‚îÇ  ‚îÇ    "version": str,                  # "1"                                   ‚îÇ‚îÇ
‚îÇ  ‚îÇ    "status": str,                   # "draft" | "published"                 ‚îÇ‚îÇ
‚îÇ  ‚îÇ    "metadata": Metadata,                                                    ‚îÇ‚îÇ
‚îÇ  ‚îÇ    "entries": List[SOWEntry]        # All lessons                           ‚îÇ‚îÇ
‚îÇ  ‚îÇ  }                                                                          ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## Implementation Details

### Python Code Pattern (All Phases)

```python
"""Pattern for all Claude Agent SDK calls with native structured output."""

from claude_agent_sdk import query
from pydantic import BaseModel


async def run_with_structured_output(
    prompt: str,
    output_schema: type[BaseModel],
    context_files: dict[str, str],  # filename -> content
    workspace_path: Path,
    allowed_tools: list[str] = None
) -> BaseModel:
    """Generic helper for structured output queries.

    Args:
        prompt: The full prompt with instructions
        output_schema: Pydantic model class for output
        context_files: Files to write to workspace for agent to read
        workspace_path: Working directory
        allowed_tools: Tools the agent can use (default: Read only)

    Returns:
        Validated Pydantic model instance
    """

    # Write context files to workspace
    for filename, content in context_files.items():
        (workspace_path / filename).write_text(content)

    result = None

    async for message in query(
        prompt=prompt,
        options={
            "cwd": str(workspace_path),
            "allowed_tools": allowed_tools or ["Read"],
            "output_format": {
                "type": "json_schema",
                "schema": output_schema.model_json_schema()
            }
        }
    ):
        if hasattr(message, 'structured_output'):
            result = output_schema.model_validate(message.structured_output)

        # Handle error cases
        if hasattr(message, 'subtype'):
            if message.subtype == 'error_max_structured_output_retries':
                raise ValueError(f"Could not produce valid {output_schema.__name__}")

    if result is None:
        raise ValueError(f"No structured output received for {output_schema.__name__}")

    return result
```

---

### Phase 1A: Outline Author Implementation

```python
async def _run_outline_author(self, workspace_path: Path) -> LessonOutline:
    """Generate lesson outline with native structured output.

    INPUTS:
      - /workspace/Course_outcomes.json (pre-written by Phase 0)
      - outline_author_prompt.md (loaded from prompts/)

    OUTPUT:
      - LessonOutline (Pydantic model, NOT a file)
    """

    prompt = self._load_prompt("outline_author_prompt.md")
    prompt += """

## YOUR TASK

Read /workspace/Course_outcomes.json and generate a lesson outline.

The outline should:
1. Cover all standards/skills from Course_outcomes.json
2. Use only 'teach' and 'mock_exam' lesson types
3. Group 2-4 related standards per teach lesson
4. Place mock_exam within last 3 lessons
5. Respect prerequisite dependencies in ordering
"""

    outline = await run_with_structured_output(
        prompt=prompt,
        output_schema=LessonOutline,
        context_files={},  # Course_outcomes.json already written by Phase 0
        workspace_path=workspace_path,
        allowed_tools=["Read"]
    )

    logger.info(f"üìã Outline generated: {outline.total_lessons} lessons")
    return outline
```

---

### Phase 1B: Outline Critic Implementation

```python
async def _run_outline_critic(
    self,
    workspace_path: Path,
    outline: LessonOutline
) -> OutlineCriticResult:
    """Critique outline with native structured output.

    INPUTS:
      - /workspace/Course_outcomes.json
      - LessonOutline (passed as context, written to temp file)
      - outline_critic_prompt.md

    OUTPUT:
      - OutlineCriticResult (Pydantic model)
    """

    prompt = self._load_prompt("outline_critic_prompt.md")
    prompt += """

## YOUR TASK

Read the lesson outline and evaluate against 5 dimensions:
1. Coverage - All standards mapped to lessons?
2. Sequencing - Prerequisites respected?
3. Balance - Block distribution reasonable?
4. Progression - Complexity increases appropriately?
5. Chunking - 2-4 standards per lesson?

Return your structured critique with verdict, scores, and guidance.
"""

    critic_result = await run_with_structured_output(
        prompt=prompt,
        output_schema=OutlineCriticResult,
        context_files={
            "lesson_outline.json": outline.model_dump_json(indent=2)
        },
        workspace_path=workspace_path,
        allowed_tools=["Read"]
    )

    logger.info(f"üîç Outline critic: {critic_result.verdict} ({critic_result.overall_score})")
    return critic_result
```

---

### Phase 2A: Lesson Author Implementation

```python
async def _run_lesson_author(
    self,
    workspace_path: Path,
    order: int,
    outline_entry: LessonOutlineEntry,
    previous_lessons: list[SOWEntry]
) -> SOWEntry:
    """Generate single lesson with native structured output.

    INPUTS:
      - /workspace/Course_outcomes.json
      - LessonOutlineEntry (current lesson's outline)
      - Previous SOWEntry[] (for coherence context)
      - lesson_entry_prompt.md

    OUTPUT:
      - SOWEntry (Pydantic model)
    """

    prompt = self._load_prompt("lesson_entry_prompt.md")
    prompt += f"""

## YOUR TASK

Generate lesson {order}: "{outline_entry.label_hint}"

This lesson should:
1. Cover standards: {outline_entry.standards_or_skills_codes}
2. Be lesson_type: {outline_entry.lesson_type}
3. Belong to block: {outline_entry.block_name} ({outline_entry.block_index})
4. Follow the card sequence: starter ‚Üí explainer ‚Üí modelling ‚Üí practice ‚Üí exit_ticket
5. Include Scottish context and real-world applications
6. Provide accessibility adaptations

Previous lessons for coherence context are in /workspace/previous_lessons.json
"""

    lesson = await run_with_structured_output(
        prompt=prompt,
        output_schema=SOWEntry,
        context_files={
            "current_outline_entry.json": outline_entry.model_dump_json(indent=2),
            "previous_lessons.json": json.dumps(
                [l.model_dump() for l in previous_lessons], indent=2
            )
        },
        workspace_path=workspace_path,
        allowed_tools=["Read", "WebSearch", "WebFetch"]  # Web research for content
    )

    logger.info(f"üìù Lesson {order} generated: {lesson.label}")
    return lesson
```

---

### Phase 2B: Lesson Critic Implementation

```python
async def _run_lesson_critic(
    self,
    workspace_path: Path,
    lesson: SOWEntry,
    outline_entry: LessonOutlineEntry
) -> LessonCriticResult:
    """Critique single lesson with native structured output.

    INPUTS:
      - /workspace/Course_outcomes.json
      - SOWEntry (the lesson to critique)
      - LessonOutlineEntry (expected standards)
      - lesson_critic_prompt.md

    OUTPUT:
      - LessonCriticResult (Pydantic model)
    """

    prompt = self._load_prompt("lesson_critic_prompt.md")
    prompt += f"""

## YOUR TASK

Critique lesson {lesson.order}: "{lesson.label}"

Evaluate against 5 dimensions:
1. Coverage - Are standards {outline_entry.standards_or_skills_codes} addressed in cards?
2. Sequencing - Does card flow follow starter ‚Üí explainer ‚Üí practice ‚Üí exit?
3. Policy - Are engagement_tags honored? Is CFU specific?
4. Accessibility - Are adaptations provided for diverse learners?
5. Authenticity - Is Scottish context used? Real-world relevance?

Return your structured critique with verdict, scores, and guidance.
"""

    critic_result = await run_with_structured_output(
        prompt=prompt,
        output_schema=LessonCriticResult,
        context_files={
            "current_lesson.json": lesson.model_dump_json(indent=2),
            "current_outline_entry.json": outline_entry.model_dump_json(indent=2)
        },
        workspace_path=workspace_path,
        allowed_tools=["Read"]
    )

    logger.info(f"üîç Lesson {lesson.order} critic: {critic_result.verdict} ({critic_result.overall_score})")
    return critic_result
```

---

### Phase 3: Metadata Author Implementation

```python
async def _run_metadata_author(
    self,
    workspace_path: Path,
    outline: LessonOutline,
    lessons: list[SOWEntry]
) -> Metadata:
    """Generate course metadata with native structured output.

    INPUTS:
      - LessonOutline (course structure)
      - All SOWEntry[] (all lessons)
      - metadata_author_prompt.md

    OUTPUT:
      - Metadata (Pydantic model)
    """

    prompt = self._load_prompt("metadata_author_prompt.md")
    prompt += """

## YOUR TASK

Generate course-level metadata that:
1. Summarizes the learning journey (coherence.narrative_summary)
2. Identifies cross-lesson connections
3. Notes course-level accessibility considerations
4. Notes course-level engagement strategies
5. Estimates duration (weeks, periods_per_week)
"""

    metadata = await run_with_structured_output(
        prompt=prompt,
        output_schema=Metadata,
        context_files={
            "lesson_outline.json": outline.model_dump_json(indent=2),
            "all_lessons.json": json.dumps(
                [l.model_dump() for l in lessons], indent=2
            )
        },
        workspace_path=workspace_path,
        allowed_tools=["Read"]
    )

    logger.info("üìä Metadata generated")
    return metadata
```

---

### Phase 4: Assembly (Python Only)

```python
def _assemble_sow(
    self,
    outline: LessonOutline,
    lessons: list[SOWEntry],
    metadata: Metadata,
    course_id: str,
    version: str
) -> AuthoredSOW:
    """Assemble final SOW from components (Python only, no LLM).

    INPUTS:
      - LessonOutline
      - List[SOWEntry]
      - Metadata
      - course_id, version

    OUTPUT:
      - AuthoredSOW (Pydantic model)
    """

    # Validate lesson count matches outline
    if len(lessons) != outline.total_lessons:
        raise ValueError(
            f"Lesson count mismatch: outline has {outline.total_lessons}, "
            f"but {len(lessons)} lessons were generated"
        )

    # Validate lesson order
    for i, lesson in enumerate(lessons):
        expected_order = i + 1
        if lesson.order != expected_order:
            raise ValueError(
                f"Lesson order mismatch at index {i}: "
                f"expected {expected_order}, got {lesson.order}"
            )

    # Assemble final SOW
    sow = AuthoredSOW(
        courseId=course_id,
        version=version,
        status="draft",
        metadata=metadata,
        entries=lessons
    )

    logger.info(f"‚úÖ SOW assembled: {len(sow.entries)} lessons")
    return sow
```

---

## Complete Flow Pseudocode

```python
async def execute(self, courseId: str, version: str = "1") -> dict:
    """Main execution with structured output throughout."""

    workspace_path = self._create_workspace()

    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    # PHASE 0: Extract course data (Python, no LLM)
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    course_outcomes = await self._extract_course_outcomes(courseId)
    (workspace_path / "Course_outcomes.json").write_text(
        json.dumps(course_outcomes, indent=2)
    )

    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    # PHASE 1: Outline Generation + Critic Loop
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    MAX_OUTLINE_ITERATIONS = 3
    outline = None

    for iteration in range(MAX_OUTLINE_ITERATIONS):
        logger.info(f"üìã Phase 1 iteration {iteration + 1}/{MAX_OUTLINE_ITERATIONS}")

        # 1A: Generate outline (structured output ‚Üí LessonOutline)
        outline = await self._run_outline_author(workspace_path)

        # 1B: Critique outline (structured output ‚Üí OutlineCriticResult)
        critic_result = await self._run_outline_critic(workspace_path, outline)

        if critic_result.verdict == "PASS":
            logger.info(f"‚úÖ Outline PASSED (score: {critic_result.overall_score})")
            break

        # Write feedback for revision
        logger.warning(f"‚ö†Ô∏è Outline needs revision: {critic_result.revision_guidance}")
        (workspace_path / "outline_critic_feedback.json").write_text(
            critic_result.model_dump_json(indent=2)
        )

        if iteration == MAX_OUTLINE_ITERATIONS - 1:
            raise ValueError(f"Outline failed after {MAX_OUTLINE_ITERATIONS} iterations")

    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    # PHASE 2: Lesson Generation + Per-Lesson Critic Loop
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    MAX_LESSON_ITERATIONS = 2
    generated_lessons: list[SOWEntry] = []

    for outline_entry in outline.outlines:
        logger.info(f"üìù Generating lesson {outline_entry.order}/{outline.total_lessons}")

        for iteration in range(MAX_LESSON_ITERATIONS):
            # 2A: Generate lesson (structured output ‚Üí SOWEntry)
            lesson = await self._run_lesson_author(
                workspace_path,
                outline_entry.order,
                outline_entry,
                generated_lessons  # Previous lessons for coherence
            )

            # 2B: Critique lesson (structured output ‚Üí LessonCriticResult)
            critic_result = await self._run_lesson_critic(
                workspace_path, lesson, outline_entry
            )

            if critic_result.verdict == "PASS":
                logger.info(f"‚úÖ Lesson {lesson.order} PASSED ({critic_result.overall_score})")
                break

            logger.warning(f"‚ö†Ô∏è Lesson {lesson.order} needs revision")
            (workspace_path / f"lesson_{lesson.order:02d}_critic_feedback.json").write_text(
                critic_result.model_dump_json(indent=2)
            )

            if iteration == MAX_LESSON_ITERATIONS - 1:
                logger.warning(f"‚ö†Ô∏è Lesson {lesson.order} accepted with warnings")

        generated_lessons.append(lesson)

    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    # PHASE 3: Metadata Generation (structured output ‚Üí Metadata)
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    metadata = await self._run_metadata_author(workspace_path, outline, generated_lessons)

    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    # PHASE 4: Assembly + Upsert (Python only)
    # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    final_sow = self._assemble_sow(outline, generated_lessons, metadata, courseId, version)

    # Write final SOW to workspace for debugging
    (workspace_path / "authored_sow.json").write_text(final_sow.model_dump_json(indent=2))

    # Upsert to Appwrite
    document_id = await self._upsert_to_appwrite(final_sow)

    return {
        "success": True,
        "document_id": document_id,
        "total_lessons": len(final_sow.entries),
        "workspace_path": str(workspace_path)
    }
```

---

## Files to Create/Modify

### New Files

| File | Purpose |
|------|---------|
| `src/tools/critic_schema_models.py` | `OutlineCriticResult`, `LessonCriticResult`, `DimensionScore` |
| `src/prompts/outline_critic_prompt.md` | Prompt for outline critic |
| `src/prompts/lesson_critic_prompt.md` | Prompt for per-lesson critic |

### Files to Modify

| File | Changes |
|------|---------|
| `src/iterative_sow_author.py` | Complete rewrite using native structured output pattern |
| `src/tools/sow_schema_models.py` | Simplify `LessonOutline` (teach + mock_exam only) |
| `src/prompts/outline_author_prompt.md` | Update for simplified outline + structured output |
| `src/prompts/lesson_entry_prompt.md` | Update for structured output (no file writing) |
| `src/prompts/metadata_author_prompt.md` | Update for structured output |

### Validator Tools (Belt-and-Braces)

The following validator tools are **RETAINED** as belt-and-braces alongside native structured output:

| File | Purpose |
|------|---------|
| `src/tools/sow_outline_validator_tool.py` | Secondary validation layer for LessonOutline |
| `src/tools/sow_entry_validator_tool.py` | Secondary validation layer for SOWEntry |
| `src/tools/sow_metadata_validator_tool.py` | Secondary validation layer for Metadata |

**Rationale**: While Claude Agent SDK's `output_format` provides schema enforcement during generation, keeping these validators provides:
- Defense-in-depth (double validation catches edge cases)
- Useful for debugging when structured output fails
- Can be called manually to validate JSON files in workspace
- Enables testing without LLM calls

---

## Implementation Order

| Phase | Task | Priority | Est. Time |
|-------|------|----------|-----------|
| 1 | Create `critic_schema_models.py` | üî¥ HIGH | 30 min |
| 2 | Simplify `LessonOutline` in `sow_schema_models.py` | üî¥ HIGH | 30 min |
| 3 | Update `outline_author_prompt.md` | üî¥ HIGH | 45 min |
| 4 | Create `outline_critic_prompt.md` | üî¥ HIGH | 1 hour |
| 5 | Create `lesson_critic_prompt.md` | üî¥ HIGH | 1 hour |
| 6 | Rewrite `iterative_sow_author.py` | üî¥ HIGH | 3 hours |
| 7 | Update `lesson_entry_prompt.md` | üü° MED | 45 min |
| 8 | Update `metadata_author_prompt.md` | üü° MED | 30 min |
| 9 | Update tests | üî¥ HIGH | 2 hours |

**Total Estimated Time**: ~9.5 hours

---

## Success Criteria

- ‚úÖ ALL LLM calls use `output_format` with Pydantic schemas
- ‚úÖ NO file-based output pattern (agents don't write JSON files)
- ‚úÖ Outline only allows `teach` and `mock_exam` lesson types (NOT revision, formative_assessment, independent_practice)
- ‚úÖ Outline critic validates coverage, sequencing, balance, progression, chunking
- ‚úÖ Lesson critic validates coverage, sequencing, policy, accessibility, authenticity
- ‚úÖ Critic loops terminate with PASS or after max iterations
- ‚úÖ Final `AuthoredSOW` is fully validated Pydantic model
- ‚úÖ Validator tools retained as belt-and-braces (secondary validation layer)
- ‚úÖ All tests pass

---

**End of Plan**
